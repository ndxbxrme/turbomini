<!doctype html>
<html>
  <body>
    <page></page>
    <script type="module">
      import { TurboMini } from '../../src/turbomini.js';
      const app = TurboMini('/tests/e2e/middleware.html');
      app.template('default', '<a id="admin-link" href="/admin">Admin</a> <a id="delay-link" href="/delayed">Delayed</a><h1 id="home">Home</h1>');
      app.template('admin', '<h1 id="admin">Admin</h1>');
      app.template('delayed', '<h1 id="delayed">Delayed</h1>');
      app.controller('default', () => ({}));
      app.controller('admin', () => ({}));
      app.controller('delayed', () => ({}));
      app.addMiddleware(async (ctx) => {
        if (ctx.page === 'admin') return false;
        if (ctx.page === 'delayed') {
          await new Promise(r => setTimeout(r, 300));
        }
      });
      app.start();
      window.app = app;
    </script>
  </body>
</html>
